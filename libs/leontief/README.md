# Библиотека leontief для TI-Nspire

Библиотека для работы с моделью межотраслевого баланса Леонтьева:
- Проверка продуктивности матриц
- Вычисление конечного потребления по валовому выпуску
- Расчёт изменения валового выпуска при изменении конечного потребления
- Вычисление требуемого валового производства по межотраслевым потокам

## Файлы

- `build/leontief.tns` - готовая библиотека для калькулятора
- `libs/leontief/Document.xml` - конфигурационный файл
- `libs/leontief/Problem1.xml` - код функций

## Установка на калькулятор

1. Скопировать `build/leontief.tns` в папку `/MyLib` на калькуляторе
2. Нажать **Ctrl+Home** → **Refresh Libraries**
3. Функции доступны в Catalog как `leontief\function_name()`

## Функции

### `leontief\version()`

Возвращает версию библиотеки.

**Пример:**
```
leontief\version()
→ "1.0.0"
```

### `leontief\is_productive(matrix_a)`

Проверяет продуктивность матрицы методом сумм столбцов (достаточный признак).

Возвращает:
- `1` если матрица продуктивна (все суммы столбцов < 1)
- `0` если матрица не продуктивна

**Пример:**
```
leontief\is_productive([[0.04,0.02,0.06],[0.10,0.14,0.06],[0.06,0.04,0.08]])
→ 1
```

### `leontief\calc_demand(matrix_a, output_x)`

Вычисляет вектор конечного потребления Y по матрице прямых затрат A и вектору валового выпуска X.

**Формула:** Y = (E - A) · X

Возвращает вектор-столбец Y (конечное потребление).

**Параметры:**
- `matrix_a` - матрица прямых затрат A
- `output_x` - вектор-столбец валового выпуска X

**Пример:**
```
leontief\calc_demand([[0.04,0.02,0.06],[0.10,0.14,0.06],[0.06,0.04,0.08]], [[100][200][150]])
→ [[88]
   [164]
   [129]]
```

**Задача:** Дана матрица прямых затрат A и вектор валового выпуска X = [100, 200, 150]ᵀ. Найти конечное потребление Y.

**Ответ:** Y = [88, 164, 129]ᵀ

### `leontief\show_demand(matrix_a, output_x)`

Программа с пошаговым выводом решения для вычисления конечного потребления Y = (E - A) · X.

1. Вывод исходной матрицы A и вектора выпуска X
2. Вычисление матрицы (E-A)
3. Вычисление Y = (E-A) · X
4. Показ конечного потребления по секторам

**Параметры:**
- `matrix_a` - матрица прямых затрат A
- `output_x` - вектор-столбец валового выпуска X

**Пример использования:**
```
leontief\show_demand([[0.04,0.02,0.06],[0.10,0.14,0.06],[0.06,0.04,0.08]], [[100][200][150]])
```

**Вывод:**
```
=== FINAL DEMAND CALCULATOR ===

Input matrix A:
[[0.04  0.02  0.06]
 [0.10  0.14  0.06]
 [0.06  0.04  0.08]]

Gross output vector X:
[[100]
 [200]
 [150]]

Step 1: Compute (E-A)
[[0.96  -0.02  -0.06]
 [-0.10  0.86  -0.06]
 [-0.06  -0.04  0.92]]

Step 2: Compute Y = (E-A)·X
[[88]
 [164]
 [129]]

Final demand by sector:
Sector 1: Y1 = 88
Sector 2: Y2 = 164
Sector 3: Y3 = 129
```

### `leontief\check_prod(matrix_a)`

Программа с пошаговым выводом решения:
1. Вывод исходной матрицы A
2. Проверка сумм по столбцам (достаточный признак)
3. Вычисление матрицы (E-A)
4. Вычисление обратной матрицы (E-A)^(-1)
5. Финальный результат: PRODUCTIVE или NOT PRODUCTIVE

**Пример использования:**
```
leontief\check_prod([[0.04,0.02,0.06],[0.10,0.14,0.06],[0.06,0.04,0.08]])
```

**Вывод:**
```
=== LEONTIEF PRODUCTIVITY ===

Input matrix A:
[[0.04  0.02  0.06]
 [0.10  0.14  0.06]
 [0.06  0.04  0.08]]

Step 1: Column sums
Col 1: 0.2
  Sum < 1 (ok)
Col 2: 0.2
  Sum < 1 (ok)
Col 3: 0.2
  Sum < 1 (ok)

All column sums < 1

Step 2: Compute (E-A)
[[0.96  -0.02  -0.06]
 [-0.10  0.86  -0.06]
 [-0.06  -0.04  0.92]]

Step 3: Compute (E-A)^(-1)
[[1.0526  0.0296  0.0703]
 [0.1316  1.1695  0.0877]
 [0.0789  0.0591  1.0965]]

RESULT: PRODUCTIVE
```

### `leontief\solve_output(matrix_a, delta_y)`

Решает задачу об изменении валового выпуска при изменении конечного потребления.

**Алгоритм:**
1. Вычисляет B = (E - A)
2. Находит обратную матрицу B⁻¹ = (E - A)⁻¹
3. Вычисляет изменение валового выпуска ΔX = (E - A)⁻¹ · ΔY
4. Показывает изменения по каждому сектору

**Параметры:**
- `matrix_a` - матрица прямых затрат A
- `delta_y` - вектор-столбец изменения конечного потребления ΔY

**Пример использования:**
```
leontief\solve_output([[0.04,0.02,0.06],[0.10,0.14,0.06],[0.06,0.04,0.08]], [[0][2][0]])
```

**Задача:** Найти изменение выпуска третьего сектора при увеличении конечного потребления продукта 2 на 2 единицы.

**Вывод:**
```
=== OUTPUT CHANGE SOLVER ===

Input matrix A:
[[0.04  0.02  0.06]
 [0.10  0.14  0.06]
 [0.06  0.04  0.08]]

Final demand change ΔY:
[[0]
 [2]
 [0]]

Step 1: Compute (E-A)
[[0.96  -0.02  -0.06]
 [-0.10  0.86  -0.06]
 [-0.06  -0.04  0.92]]

Step 2: Compute (E-A)^(-1)
[[1.0526  0.0296  0.0703]
 [0.1316  1.1695  0.0877]
 [0.0789  0.0591  1.0965]]

Step 3: Compute ΔX = (E-A)^(-1)·ΔY
[[0.0592]
 [2.339]
 [0.1182]]

Output changes by sector:
Sector 1: ΔX1 = 0.0592
Sector 2: ΔX2 = 2.339
Sector 3: ΔX3 = 0.1182
```

**Ответ:** ΔX₃ = 0.1182 (изменение выпуска третьего сектора)

### `leontief\calc_output(xij, y, ystar)`

Вычисляет требуемое валовое производство X* по матрице межотраслевых потоков, текущему конечному спросу и требуемому конечному потреблению.

**Алгоритм:**
1. Вычисляет текущий валовой выпуск: X_j = (∑_i x_ij) + Y_j
2. Строит матрицу прямых затрат A: a_ij = x_ij / X_j
3. Вычисляет (E - A)
4. Находит обратную матрицу (E - A)⁻¹
5. Вычисляет требуемое производство X* = (E - A)⁻¹ · Y*
6. Показывает требуемое производство по каждому сектору

**Параметры:**
- `xij` - матрица межотраслевых потоков (n×n)
- `y` - вектор текущего конечного спроса Y (n×1)
- `ystar` - вектор требуемого конечного потребления Y* (n×1)

**Пример использования:**
```
leontief\calc_output([[10,30,10][30,50,20][10,20,20]], [[150][0][50]], [[60][120][60]])
```

**Задача:** По матрице межотраслевых потоков {x_ij} и текущему конечному спросу Y = [150, 0, 50]ᵀ найти требуемое валовое производство для обеспечения конечного потребления Y* = [60, 120, 60]ᵀ.

**Вывод:**
```
=== REQUIRED OUTPUT SOLVER ===

Input flow matrix {x_ij}:
[[10   30   10]
 [30   50   20]
 [10   20   20]]

Current final demand Y:
[[150]
 [0]
 [50]]

Required final demand Y*:
[[60]
 [120]
 [60]]

Step 1: Compute gross output X
X_j = (sum_i x_ij) + Y_j
[[200]
 [100]
 [100]]

Step 2: Compute matrix A
a_ij = x_ij / X_j
[[0.05  0.3   0.1]
 [0.15  0.5   0.2]
 [0.05  0.2   0.2]]

Step 3: Compute (E-A)
[[0.95  -0.3   -0.1]
 [-0.15  0.5   -0.2]
 [-0.05  -0.2   0.8]]

Step 4: Compute (E-A)^(-1)
[[1.19   0.83   0.33]
 [0.48   1.90   0.48]
 [0.24   0.64   1.31]]

Step 5: Compute X* = (E-A)^(-1)·Y*
[[120]
 [280]
 [160]]

Required production by sector:
Sector 1: X*1 = 120
Sector 2: X*2 = 280
Sector 3: X*3 = 160
```

**Ответ:** Для обеспечения конечного потребления Y* = [60, 120, 60]ᵀ необходимо валовое производство X* = [120, 280, 160]ᵀ.

## Решение задачи

Для матрицы:
```
A = [0.04  0.02  0.06]
    [0.10  0.14  0.06]
    [0.06  0.04  0.08]
```

### Быстрая проверка:
```
leontief\is_productive([[0.04,0.02,0.06],[0.10,0.14,0.06],[0.06,0.04,0.08]])
→ 1
```

### Подробное решение:
```
leontief\check_prod([[0.04,0.02,0.06],[0.10,0.14,0.06],[0.06,0.04,0.08]])
```
Выведет пошаговое решение с проверкой столбцов, вычислением (E-A) и (E-A)^(-1).

## Теория

Матрица A называется **продуктивной**, если существует ненулевой вектор выпуска X > 0.

**Теорема Леонтьева:** Матрица A продуктивна ⟺ матрица (E-A) имеет неотрицательную обратную матрицу.

**Достаточный признак:** Если сумма элементов в каждом столбце матрицы A строго меньше 1, то матрица продуктивна.

## Пересборка

```bash
./scripts/build.sh leontief
```
